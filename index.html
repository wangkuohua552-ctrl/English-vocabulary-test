<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹ä¸­è‹±æ–‡ AI å­¸ç¿’ç«™ - èªéŸ³æ•™ç·´ç‰ˆ</title>
    <style>
        :root { --primary: #4a90e2; --secondary: #ff4757; --success: #2ecc71; --bg: #f8f9fa; --sentence: #9b59b6; --phrase: #e67e22; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .container { background: white; width: 95%; max-width: 500px; padding: 25px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); text-align: center; margin-top: 10px; }
        .type-badge { display: inline-block; padding: 6px 16px; border-radius: 50px; color: white; font-size: 14px; margin-bottom: 15px; font-weight: bold; text-transform: uppercase; }
        .word-title { font-size: 30px; margin: 15px 0; color: #2d3436; line-height: 1.3; min-height: 100px; display: flex; align-items: center; justify-content: center; padding: 0 10px; }
        .chinese { font-size: 1.4rem; color: var(--primary); font-weight: bold; margin: 10px 0; }
        .btn { padding: 15px 25px; border-radius: 50px; border: none; cursor: pointer; font-weight: bold; margin: 5px; font-size: 16px; transition: 0.3s; }
        .btn-record { background: var(--secondary); color: white; width: 100%; margin-top: 15px; box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3); }
        .btn-record.active { background: #333; transform: scale(0.95); }
        #feedbackArea { margin-top: 20px; text-align: left; padding: 20px; border-radius: 15px; background: #fff9db; display: none; border-left: 8px solid #f1c40f; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div id="typeBadge" class="type-badge">LOADING</div>
    <div class="word-card">
        <div class="word-title" id="displayWord">è«‹ç¨å€™...</div>
        <button class="btn" style="background:#f1f2f6" onclick="playTargetVoice()">ğŸ”Š è½æ­£ç¢ºç™¼éŸ³</button>
        <div class="chinese" id="displayChinese"></div>
        <button id="recordBtn" class="btn btn-record">ğŸ¤ é•·æŒ‰é–‹å§‹ç·´ç¿’</button>
        <div style="margin-top:20px; display:flex; gap:10px;">
            <button class="btn" onclick="prevWord()" style="flex:1; background:#eee;">â—€ ä¸Šä¸€é¡Œ</button>
            <button class="btn" onclick="nextWord()" style="flex:1; background:#eee;">ä¸‹ä¸€é¡Œ â–¶</button>
        </div>
    </div>
    <div id="feedbackArea">
        <div id="aiDiagnosis" style="font-weight:bold; color:#d35400; font-size: 1.2rem; margin-bottom: 8px;"></div>
        <div id="aiCoachNote" style="font-size: 1rem; color: #555; line-height: 1.4;"></div>
    </div>
</div>

<script>
    let wordBank = [];
    let currentIndex = 0;

    async function loadWords() {
        const response = await fetch('words.json?v=' + Date.now());
        wordBank = await response.json();
        // éš¨æ©Ÿæ‰“äº‚é¡Œç›®
        wordBank.sort(() => Math.random() - 0.5);
        updateUI();
    }

    function updateUI() {
        if (wordBank.length === 0) return;
        const item = wordBank[currentIndex];
        const wordEl = document.getElementById('displayWord');
        const badgeEl = document.getElementById('typeBadge');
        
        if (item.type === 'sentence') {
            badgeEl.innerText = "â­ æ ¸å¿ƒå¥å‹ç·´ç¿’";
            badgeEl.style.background = "var(--sentence)";
            wordEl.style.fontSize = "24px";
        } else if (item.type === 'phrase') {
            badgeEl.innerText = "ğŸ’¡ å¿…è€ƒç‰‡èªç·´ç¿’";
            badgeEl.style.background = "var(--phrase)";
            wordEl.style.fontSize = "30px";
        } else {
            badgeEl.innerText = "ğŸ“– åŸºç¤å–®å­—ç·´ç¿’";
            badgeEl.style.background = "var(--primary)";
            wordEl.style.fontSize = "38px";
        }

        wordEl.innerText = item.word;
        document.getElementById('displayChinese').innerText = item.chinese;
        document.getElementById('feedbackArea').style.display = 'none';
    }

    function playTargetVoice() {
        const utter = new SpeechSynthesisUtterance(wordBank[currentIndex].word);
        utter.lang = 'en-US';
        utter.rate = 0.8;
        window.speechSynthesis.speak(utter);
    }

    function aiSpeakFeedback(text) {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'zh-TW';
        utter.rate = 1.1;
        window.speechSynthesis.speak(utter);
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        const recordBtn = document.getElementById('recordBtn');

        recordBtn.onmousedown = () => { 
            recognition.start(); 
            recordBtn.classList.add('active'); 
            recordBtn.innerText = "æ­£åœ¨è†è½ä¸­...";
        };
        recordBtn.onmouseup = () => { 
            recognition.stop(); 
            recordBtn.classList.remove('active'); 
            recordBtn.innerText = "ğŸ¤ é•·æŒ‰é–‹å§‹ç·´ç¿’";
        };

        recognition.onresult = (e) => {
            const result = e.results[0][0].transcript.toLowerCase().trim();
            const target = wordBank[currentIndex].word.toLowerCase().replace(/[.,?!]/g, "");
            const cleanResult = result.replace(/[.,?!]/g, "");
            
            document.getElementById('feedbackArea').style.display = 'block';
            
            let feedbackText = "";
            let isCorrect = false;

            // åˆ¤æ–·é‚è¼¯ï¼šå¥å­å®¹è¨± 80% ç›¸ä¼¼åº¦
            if (cleanResult === target || target.includes(cleanResult)) {
                isCorrect = true;
                document.getElementById('aiDiagnosis').innerText = "âœ… éå¸¸å„ªç§€ï¼";
                feedbackText = "å¤ªæ£’äº†ï¼Œç™¼éŸ³éå¸¸æ¨™æº–ï¼ç¹¼çºŒä¿æŒã€‚";
            } else {
                document.getElementById('aiDiagnosis').innerText = "âŒ å·®ä¸€é»é»å°±å°äº†";
                feedbackText = `è½èµ·ä¾†æœ‰é»åƒ ${result}ã€‚å»ºè­°å†è½ä¸€æ¬¡æ­£ç¢ºç™¼éŸ³ä¸¦è©¦è‘—æ¨¡ä»¿ã€‚`;
            }

            document.getElementById('aiCoachNote').innerText = `ä½ å‰›æ‰èªªçš„æ˜¯ï¼š "${result}"`;
            aiSpeakFeedback(feedbackText);
        };
    }

    function nextWord() { currentIndex = (currentIndex + 1) % wordBank.length; updateUI(); }
    function prevWord() { currentIndex = (currentIndex - 1 + wordBank.length) % wordBank.length; updateUI(); }

    window.onload = loadWords;
</script>
</body>
</html>
