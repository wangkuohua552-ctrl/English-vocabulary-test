<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹ä¸­è‹±æ–‡ AI å­¸ç¿’ç«™ - å…¨æ–¹ä½ç‰ˆ</title>
    <style>
        :root { --primary: #4a90e2; --secondary: #ff4757; --success: #2ecc71; --bg: #f8f9fa; --sentence: #9b59b6; --phrase: #e67e22; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; width: 95%; max-width: 500px; padding: 25px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); text-align: center; }
        .type-badge { display: inline-block; padding: 4px 12px; border-radius: 50px; color: white; font-size: 12px; margin-bottom: 10px; font-weight: bold; }
        .word-title { font-size: 32px; margin: 10px 0; color: #2d3436; line-height: 1.2; min-height: 80px; display: flex; align-items: center; justify-content: center; }
        .phonetic { color: #636e72; font-size: 1rem; margin-bottom: 10px; }
        .chinese { font-size: 1.3rem; color: var(--primary); font-weight: bold; margin: 10px 0; }
        .btn { padding: 12px 24px; border-radius: 50px; border: none; cursor: pointer; font-weight: bold; margin: 5px; }
        .btn-record { background: var(--secondary); color: white; width: 100%; margin-top: 15px; }
        .btn-record.active { background: #333; animation: pulse 1s infinite; }
        #feedbackArea { margin-top: 20px; text-align: left; padding: 15px; border-radius: 12px; background: #fff9db; display: none; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="container">
    <div id="typeBadge" class="type-badge">è¼‰å…¥ä¸­</div>
    <div class="word-card">
        <div class="word-title" id="displayWord">è¼‰å…¥ä¸­...</div>
        <button class="btn" style="background:#f1f2f6" onclick="playCurrent()">ğŸ”Š æ’­æ”¾ç™¼éŸ³</button>
        <div class="phonetic" id="displayPhonetic"></div>
        <div class="chinese" id="displayChinese"></div>
        <button id="recordBtn" class="btn btn-record">ğŸ¤ æŒ‰ä½ç·´ç¿’ç™¼éŸ³</button>
        <div style="margin-top:20px; display:flex; gap:10px;">
            <button class="btn" onclick="prevWord()" style="flex:1; background:#eee;">ä¸Šä¸€å€‹</button>
            <button class="btn" onclick="nextWord()" style="flex:1; background:#eee;">ä¸‹ä¸€å€‹</button>
        </div>
    </div>
    <div id="feedbackArea">
        <div id="aiDiagnosis" style="font-weight:bold; color:#d35400;"></div>
        <div id="aiCoachNote" style="font-size: 0.9rem;"></div>
    </div>
</div>

<script>
    let wordBank = [];
    let currentIndex = 0;

    async function loadWords() {
        // åŠ ä¸Šæ™‚é–“æˆ³è¨˜é¿å…ç€è¦½å™¨å¿«å–èˆŠçš„ words.json
        const response = await fetch('words.json?v=' + Date.now());
        wordBank = await response.json();
        updateUI();
    }

    function updateUI() {
        if (wordBank.length === 0) return;
        const item = wordBank[currentIndex];
        const wordEl = document.getElementById('displayWord');
        const badgeEl = document.getElementById('typeBadge');
        
        // é¡¯ç¤ºé¡å‹æ¨™ç±¤èˆ‡é¡è‰²
        if (item.type === 'sentence') {
            badgeEl.innerText = "å¥å­ SENTENCE";
            badgeEl.style.background = "var(--sentence)";
            wordEl.style.fontSize = "26px";
        } else if (item.type === 'phrase') {
            badgeEl.innerText = "ç‰‡èª PHRASE";
            badgeEl.style.background = "var(--phrase)";
            wordEl.style.fontSize = "32px";
        } else {
            badgeEl.innerText = "å–®å­— WORD";
            badgeEl.style.background = "var(--primary)";
            wordEl.style.fontSize = "40px";
        }

        wordEl.innerText = item.word;
        document.getElementById('displayPhonetic').innerText = item.phonetic;
        document.getElementById('displayChinese').innerText = item.chinese;
        document.getElementById('feedbackArea').style.display = 'none';
    }

    function playCurrent() {
        const utter = new SpeechSynthesisUtterance(wordBank[currentIndex].word);
        utter.lang = 'en-US';
        utter.rate = 0.8;
        window.speechSynthesis.speak(utter);
    }

    // èªéŸ³è¾¨è­˜
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        const recordBtn = document.getElementById('recordBtn');

        recordBtn.onmousedown = () => { recognition.start(); recordBtn.classList.add('active'); };
        recordBtn.onmouseup = () => { recognition.stop(); recordBtn.classList.remove('active'); };

        recognition.onresult = (e) => {
            const result = e.results[0][0].transcript.toLowerCase().trim();
            const target = wordBank[currentIndex].word.toLowerCase().replace(/[.,?!]/g, "");
            
            document.getElementById('feedbackArea').style.display = 'block';
            if (result.includes(target) || target.includes(result)) {
                document.getElementById('aiDiagnosis').innerText = "âœ… è¾¨è­˜æˆåŠŸï¼";
                document.getElementById('aiCoachNote').innerText = "ä½ å”¸çš„æ˜¯: " + result;
            } else {
                document.getElementById('aiDiagnosis').innerText = "âŒ è«‹å†è©¦ä¸€æ¬¡";
                document.getElementById('aiCoachNote').innerText = "æˆ‘è½åˆ°çš„æ˜¯: " + result;
            }
        };
    }

    function nextWord() { currentIndex = (currentIndex + 1) % wordBank.length; updateUI(); }
    function prevWord() { currentIndex = (currentIndex - 1 + wordBank.length) % wordBank.length; updateUI(); }

    window.onload = loadWords;
</script>
</body>
</html>
