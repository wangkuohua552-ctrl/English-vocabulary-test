<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹ä¸­è‹±æ–‡ AI å­¸ç¿’ç«™ - çµ‚æ¥µä¿®å¾©ç‰ˆ</title>
    <style>
        :root { --primary: #4a90e2; --secondary: #ff4757; --success: #2ecc71; --bg: #f8f9fa; --sentence: #9b59b6; --phrase: #e67e22; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; min-height: 100vh; }
        .container { background: white; width: 95%; max-width: 500px; padding: 25px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); text-align: center; }
        .score-display { font-size: 1.1rem; color: var(--success); font-weight: bold; margin-bottom: 15px; }
        .type-badge { display: inline-block; padding: 6px 16px; border-radius: 50px; color: white; font-size: 14px; margin-bottom: 15px; font-weight: bold; }
        .word-title { font-size: 28px; margin: 15px 0; color: #2d3436; line-height: 1.3; min-height: 80px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .chinese { font-size: 1.3rem; color: var(--primary); font-weight: bold; margin-bottom: 20px; }
        .btn { padding: 15px 25px; border-radius: 50px; border: none; cursor: pointer; font-weight: bold; margin: 5px; font-size: 16px; transition: 0.3s; }
        .btn-record { background: var(--secondary); color: white; width: 100%; box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3); }
        .btn-record.active { background: #333; transform: scale(0.95); }
        #feedbackArea { margin-top: 20px; text-align: left; padding: 20px; border-radius: 15px; background: #fff9db; display: none; border-left: 10px solid #f1c40f; }
        .hint { font-size: 0.85rem; color: #95a5a6; margin-top: 10px; }
    </style>
</head>
<body onclick="unlockAudio()">

<div class="container">
    <div class="score-display">ğŸŒŸ ç©åˆ†ï¼š<span id="score">0</span></div>
    <div id="typeBadge" class="type-badge">æº–å‚™ä¸­</div>
    
    <div class="word-card">
        <div class="word-title" id="displayWord">é»æ“Šä»»æ„è™•å•Ÿå‹•</div>
        <button class="btn" style="background:#f1f2f6" onclick="playTargetVoice()">ğŸ”Š è½æ­£ç¢ºç™¼éŸ³</button>
        <div class="chinese" id="displayChinese"></div>
        
        <button id="recordBtn" class="btn btn-record">ğŸ¤ æŒ‰ä½ç·´ç¿’ï¼ˆæ”¾é–‹çµæŸï¼‰</button>
        
        <div style="margin-top:20px; display:flex; gap:10px;">
            <button class="btn" onclick="prevWord()" style="flex:1; background:#eee;">â—€ ä¸Šä¸€é¡Œ</button>
            <button class="btn" onclick="nextWord()" style="flex:1; background:#eee;">ä¸‹ä¸€é¡Œ â–¶</button>
        </div>
    </div>

    <div id="feedbackArea">
        <div id="aiStatus" style="font-weight:bold; margin-bottom:5px;"></div>
        <div id="aiAdvice" style="font-size: 1rem; color: #2c3e50; line-height: 1.5;"></div>
    </div>
    
    <div class="hint">è‹¥ç„¡è²éŸ³ï¼Œè«‹å…ˆé»æ“Šç¶²é ä»»æ„è™•å†è©¦</div>
</div>

<script>
    let wordBank = [];
    let currentIndex = 0;
    let score = 0;
    let audioUnlocked = false;

    // ç™¼éŸ³ç³¾éŒ¯è¦å‰‡
    const pronunciationRules = [
        { pattern: /th/i, advice: "æ³¨æ„ th çš„å’¬èˆŒéŸ³ï¼ŒèˆŒå°–è¦æ”¾åœ¨ç‰™é½’ä¸­é–“å¹æ°£ã€‚" },
        { pattern: /r/i, advice: "æœ‰æ²èˆŒéŸ³ rï¼ŒèˆŒé ­å¾€å¾Œç¸®ï¼Œä¸è¦ç¢°åˆ°ä¸Šé¡ã€‚" },
        { pattern: /v/i, advice: "ç™¼ v çš„éŸ³ï¼Œç”¨ä¸Šæ’ç‰™é½’è¼•å’¬ä¸‹å”‡ã€‚" },
        { pattern: /l/i, advice: "æ³¨æ„ l çš„éŸ³ï¼ŒèˆŒå°–æŠµä½ä¸Šæ’ç‰™é½’å¾Œæ–¹ã€‚" },
        { pattern: /s$|s /i, advice: "å­—å°¾çš„ s è¨˜å¾—è¦ç™¼å‡ºå˜¶å˜¶è²ã€‚" }
    ];

    // è§£é–èªéŸ³å¼•æ“ (é‡å°è¡Œå‹•è£ç½®)
    function unlockAudio() {
        if (audioUnlocked) return;
        const utter = new SpeechSynthesisUtterance("");
        window.speechSynthesis.speak(utter);
        audioUnlocked = true;
        console.log("èªéŸ³å·²è§£é–");
    }

    async function loadWords() {
        try {
            const response = await fetch('words.json?v=' + Date.now());
            wordBank = await response.json();
            wordBank.sort(() => Math.random() - 0.5);
            updateUI();
        } catch (e) {
            document.getElementById('displayWord').innerText = "è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ words.json";
        }
    }

    function updateUI() {
        if (wordBank.length === 0) return;
        const item = wordBank[currentIndex];
        const wordEl = document.getElementById('displayWord');
        const badge = document.getElementById('typeBadge');
        
        wordEl.innerText = item.word;
        document.getElementById('displayChinese').innerText = item.chinese;
        
        if (item.type === 'sentence') { 
            badge.innerText = "â­ æ ¸å¿ƒå¥å‹"; badge.style.background = "#9b59b6";
            wordEl.style.fontSize = "24px";
        } else {
            badge.innerText = "ğŸ“– å–®å­—/ç‰‡èª"; badge.style.background = "#4a90e2";
            wordEl.style.fontSize = "32px";
        }
        document.getElementById('feedbackArea').style.display = 'none';
    }

    function playTargetVoice() {
        unlockAudio();
        const utter = new SpeechSynthesisUtterance(wordBank[currentIndex].word);
        utter.lang = 'en-US';
        utter.rate = 0.8;
        window.speechSynthesis.speak(utter);
    }

    function aiSpeak(text) {
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'zh-TW';
        utter.rate = 1.1;
        window.speechSynthesis.speak(utter);
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        const recordBtn = document.getElementById('recordBtn');

        recordBtn.onmousedown = () => { recognition.start(); recordBtn.classList.add('active'); };
        recordBtn.onmouseup = () => { recognition.stop(); recordBtn.classList.remove('active'); };

        recognition.onresult = (e) => {
            const userSpeech = e.results[0][0].transcript.toLowerCase().trim();
            const targetWord = wordBank[currentIndex].word.toLowerCase().replace(/[.,?!]/g, "");
            
            document.getElementById('feedbackArea').style.display = 'block';
            let advice = "";
            
            // ç³¾éŒ¯é‚è¼¯ï¼šæ¯”å°æ–‡å­—èˆ‡é è¨­è¦å‰‡
            if (userSpeech === targetWord || targetWord.includes(userSpeech)) {
                advice = "å¤ªæ£’äº†ï¼ç™¼éŸ³éå¸¸æ¨™æº–ã€‚";
                document.getElementById('aiStatus').innerHTML = "<span style='color:green'>âœ… è¾¨è­˜æˆåŠŸ</span>";
                score += 10;
            } else {
                let ruleTip = "è«‹æ³¨æ„é‡éŸ³ä¸¦è©¦è‘—æ¨¡ä»¿æ­£ç¢ºç™¼éŸ³ã€‚";
                for (let rule of pronunciationRules) {
                    if (rule.pattern.test(targetWord)) { ruleTip = rule.advice; break; }
                }
                advice = `æˆ‘è½åˆ°çš„æ˜¯ "${userSpeech}"ã€‚æé†’ä½ ï¼š${ruleTip}`;
                document.getElementById('aiStatus').innerHTML = "<span style='color:red'>âŒ éœ€è¦æ”¹é€²</span>";
            }

            document.getElementById('score').innerText = score;
            document.getElementById('aiAdvice').innerText = advice;
            aiSpeak(advice);
        };
    }

    function nextWord() { currentIndex = (currentIndex + 1) % wordBank.length; updateUI(); }
    function prevWord() { currentIndex = (currentIndex - 1 + wordBank.length) % wordBank.length; updateUI(); }

    window.onload = loadWords;
</script>
</body>
</html>
